{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart</title>

    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'cartDetails.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <script src="https://kit.fontawesome.com/50f89db14f.js"
            crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <a href="{% url 'ecommerce_app:product' %}" class="btn btn-secondary mb-4">
            Back to Products
        </a>

        {% if cart_empty %}
            <div class="alert alert-warning" role="alert">
                Your cart is empty.
            </div>
        {% else %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Price/Quantity</th>
                        <th>Total Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart_items %}
                    <tr data-item-id="{{ item.product.id }}">
                        <td class="d-flex align-items-center">
                            <img class="product-img me-3"
                                 src="{% static 'images/' %}{{ item.product.image_name }}"
                                 alt="{{ item.product.name }}">
                            <p class="description mb-0">{{ item.product.name }}</p>
                        </td>
                        <td class="quantity text-center">
                            <form method="POST"
                                  action="{% url 'ecommerce_app:update_cart' %}"
                                  style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="product_id" value="{{ item.product.id }}">
                                <input type="hidden" name="quantity" value="-1">
                                <button type="submit" class="decrement-btn btn-light"
                                        {% if item.quantity == 0 %}disabled{% endif %}>-</button>
                            </form>

                            <strong class="mx-2 quantity-val">{{ item.quantity }}</strong>

                            <form method="POST"
                                  action="{% url 'ecommerce_app:update_cart' %}"
                                  style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="product_id" value="{{ item.product.id }}">
                                <input type="hidden" name="quantity" value="1">
                                <button type="submit" class="increment-btn btn-light">+</button>
                            </form>
                        </td>
                        <td class="price-val-per-quantity">
                            ${{ item.product.price }}
                        </td>
                        <td class="price-val">
                            ${{ item.line_total }}
                        </td>
                    </tr>
                    {% endfor %}
                    <tr>
                        <td></td>
                        <td id="total-quantity">
                            <strong>Total Quantity:</strong> {{ total_quantity }}
                        </td>
                        <td></td>
                        <td id="total-price">
                            <strong>Total Price: $</strong>{{ total_price }}
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Payment + Checkout -->
            <div class="payment-card">
                <div class="payment-options">
                    <button type="button" class="btn btn-secondary">
                        <i class="fab fa-apple"></i>
                        Pay with Apple Pay
                    </button>
                    <button type="button" class="btn btn-light">
                        <i class="fa-brands fa-google"></i>
                        Pay with Google Pay
                    </button>
                </div>

                <hr>
                <h6 class="text-center">Or pay with</h6>
                <hr>

                <!-- Single form: shipping + (fake) payment inputs -->
                <form action="{% url 'ecommerce_app:place_order' %}" method="post">
                    {% csrf_token %}

                    <!-- Shipping Details -->
                    <h5>Shipping Details</h5>

                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" name="full_name" class="form-control"
                               value="{{ address.full_name|default_if_none:'' }}" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" name="phone" class="form-control"
                               value="{{ address.phone|default_if_none:'' }}" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Street Address</label>
                        <input type="text" name="street" class="form-control"
                               value="{{ address.street|default_if_none:'' }}" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">City</label>
                        <input type="text" name="city" class="form-control"
                               value="{{ address.city|default_if_none:'' }}" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">State</label>
                        <input type="text" name="state" class="form-control"
                               value="{{ address.state|default_if_none:'' }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Zip Code</label>
                        <input type="text" name="zip_code" class="form-control"
                               value="{{ address.zip_code|default_if_none:'' }}" required>
                    </div>

                    <hr>

                    <!-- Payment Details (UI only, backend can ignore) -->
                    <h5>Payment Details</h5>

                    <div class="mb-3">
                        <label for="inputEmail" class="form-label">Email address</label>
                        <input type="email" class="form-control" id="inputEmail" name="email"
                               aria-describedby="emailHelp" required>
                        <div id="emailHelp" class="form-text">
                            We'll never share your email with anyone else.
                        </div>
                    </div>

                    <div class="card-information">
                        <label for="inputCardNumber" class="form-label">Enter your card number</label>
                        <input type="number" class="form-control" id="inputCardNumber" name="card_number"
                               placeholder="1234 1234 1234 1234" required>
                        <div class="card-icons">
                            <i class="fa fa-cc-paypal"></i>
                            <i class="fa fa-cc-mastercard"></i>
                            <i class="fa fa-cc-stripe"></i>
                            <i class="fa fa-cc-visa"></i>
                        </div>

                        <div class="month-cvv">
                            <input type="text" class="form-control" id="inputExpiry" name="expiry"
                                   placeholder="MM/YYYY" required>
                            <input type="password" class="form-control" id="inputCvv" name="cvv"
                                   placeholder="CVV" required>
                        </div>

                        <hr>

                        <label for="inputName" class="form-label">Name on Card</label>
                        <input type="text" class="form-control" id="inputName" name="card_name" required>

                        <!-- Optional helper datalist (no name so backend ignores it) -->
                        <label for="exampleDataList" class="form-label">Billing City (optional)</label>
                        <input class="form-control" list="datalistOptions" id="exampleDataList"
                               placeholder="Type to search...">
                        <datalist id="datalistOptions">
                            <option value="San Francisco">
                            <option value="New York">
                            <option value="Seattle">
                            <option value="Los Angeles">
                            <option value="Chicago">
                        </datalist>

                        <div class="checkout-container mt-3">
                            <button type="submit" class="btn btn-primary">
                                Place Order
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>

    <script src="{% static 'cardDetail.js' %}"></script>
    <script>
        const updateCartURL = "{% url 'ecommerce_app:update_cart' %}";
    </script>
</body>
</html>
